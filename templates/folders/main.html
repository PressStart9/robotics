{% extends 'hatpage.html' %}
{% load poll_extras %}
{% block content %}
<body>
    <div style="margin-top: 55px; width: 60%; background-color: #eee;" class="container">
        {% for val in wall_content %}
            {% if not val.main_history %}
                <div class="post_header" style="overflow: hidden; margin-top: 20px">
                    <a class="post_image" href="https://vk.com/clubrotor1?z=photo-44637636_456239581%2Falbum-44637636_0%2Frev">
                        <img src="https://sun9-58.userapi.com/c849432/v849432728/166bfa/drbdg2Azqgs.jpg?ava=1" align="left" width="50" height="50" class="post_img">
                    </a>

                    <div class="post_header_info" style="margin-left: 60px">
                        <h5 class="post_author"><a class="author" href="https://vk.com/clubrotor1">Робототехнический клуб "Ротор" (ПМК "Исток")</a></h5>
                        <div class="post_date" style="margin: -4px 10px 0px -3px;">{{ val.posting_date|date:"d/m/Y" }}</div>
                    </div>
                </div>

                <div class="post_content" style="overflow: hidden;">
                    {% if val.text != '' %}
                        <div class="wall_post_text"><h5>{{ val.text|linebreaksbr }}</h5></div>
                    {% endif %}

                    <div class="my-gallery" itemscope itemtype="http://schema.org/ImageGallery">
                        {% for attach in val.atachs.all %}
                            {% if attach.type == 'photo' %}
                                <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
                                    <a href="{{ attach.url }}" itemprop="contentUrl" data-size="{{ attach.width }}x{{ attach.height }}" type_content="image">
                                        <img src="{{ attach.preview }}" itemprop="thumbnail" alt="Image description" />
                                    </a>
                                    <figcaption itemprop="caption description"></figcaption>
                                </figure>
                            {% endif %}
                            {% if attach.type == 'video' %}
                                <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
                                    <a href="{{ attach.url }}" itemprop="contentUrl" data-size="{{ attach.width }}x{{ attach.height }}"  type_content="video" attach_another="{{ attach.url }}" style="display: block; position: relative">
                                        <img src="{{ attach.preview }}" itemprop="thumbnail" alt="Image description">
                                        <div class="video_play"></div>
                                    </a>
                                    <figcaption itemprop="caption description"></figcaption>
                                </figure>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% for attach in val.atachs.all %}
                        {% if attach.type == 'doc' %}
                            <a class="doc_image" href="{{ attach.url }}">
                                <img src="https://w7.pngwing.com/pngs/521/255/png-transparent-computer-icons-data-file-document-file-format-others.png" style="margin: 0 0 0 -20px; max-height: 60px; max-width: 60px" align="left">
                                <h5>{{ attach.preview }}</h5>
                            </a>
                        {% endif %}
                        {% if attach.type == 'link' %}
                            <a href="{{ attach.url|Cutthecrap:1 }}">
                                <img src="{{ attach.preview }}" style="max-height: 100%; max-width: 100%; border-radius: 20px">
                                <h4 style="display: block; margin-left: 10%; position: relative; width: 70%; color: #003366">{{ attach.url|Cutthecrap:0 }}</h4>
                            </a>
                        {% endif %}
                    {% endfor %}

                    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="pswp__bg"></div>

                                <div class="pswp__scroll-wrap">
                                    <div class="pswp__container">
                                        <div class="pswp__item"></div>
                                        <div class="pswp__item"></div>
                                        <div class="pswp__item"></div>
                                    </div>

                                    <div class="pswp__ui pswp__ui--hidden">
                                        <div class="pswp__top-bar">
                                            <div class="pswp__counter"></div>
                                                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                                                <button class="pswp__button pswp__button--share" title="Share"></button>
                                                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                                                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                                                <div class="pswp__preloader">
                                                    <div class="pswp__preloader__icn">
                                                        <div class="pswp__preloader__cut">
                                                            <div class="pswp__preloader__donut"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                        </div>
                                        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                                            <div class="pswp__share-tooltip"></div>
                                        </div>
                                        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                                        </button>
                                        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                                        </button>
                                        <div class="pswp__caption">
                                            <div class="pswp__caption__center"></div>
                                        </div>
                                    </div>
                                </div>
                    </div>

                </div>

                {% if val.copy_history.all.0 %}
                    <div style="padding-left: 3%; border-left:2px solid #ccc; overflow: hidden; margin-top: 5px" class="copy_container">
                        <div class="copy_post_header">
                            <a class="copy_post_image" href="https://vk.com/clubrotor1?z=photo-44637636_456239581%2Falbum-44637636_0%2Frev">
                                <img src="{{ val.copy_history.all.0.author_image }}" align="left" width="50" height="50" class="post_img">
                            </a>

                            <div class="copy_post_header_info" style="margin-left: 60px">
                                <h5 class="post_author"><a class="author" href="https://vk.com/clubrotor1">{{ val.copy_history.all.0.author_name }}</a></h5>
                                <div class="post_date" style="margin: -4px 10px 0px -3px;">{{ val.copy_history.all.0.posting_date|date:"d/m/Y" }}</div>
                            </div>
                        </div>

                        <div class="copy_post_content">
                            {% if val.copy_history.all.0.text != '' %}
                                <div class="wall_post_text"><h5>{{ val.copy_history.all.0.text|linebreaksbr }}</h5></div>
                            {% endif %}

                            <div class="my-gallery" itemscope itemtype="http://schema.org/ImageGallery">
                                {% for attach in val.copy_history.all.0.atachs.all %}
                                    {% if attach.type == 'photo' %}
                                        <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
                                            <a href="{{ attach.url }}" itemprop="contentUrl" data-size="{{ attach.width }}x{{ attach.height }}" type_content="image">
                                                <img src="{{ attach.preview }}" itemprop="thumbnail" alt="Image description"/>
                                            </a>
                                            <figcaption itemprop="caption description"></figcaption>
                                        </figure>
                                    {% endif %}
                                    {% if attach.type == 'video' %}
                                        <figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
                                            <a href="{{ attach.url }}" itemprop="contentUrl" data-size="{{ attach.width }}x{{ attach.height }}"  type_content="video" attach_another="{{ attach.url }}" style="display: block; position: relative">
                                                <img src="{{ attach.preview }}" itemprop="thumbnail" alt="Image description">
                                                <div class="video_play"></div>
                                            </a>
                                            <figcaption itemprop="caption description"></figcaption>
                                        </figure>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            {% for attach in val.copy_history.all.0.atachs.all %}
                                {% if attach.type == 'doc' %}
                                    <a class="doc_image" href="{{ attach.url }}">
                                        <img src="https://w7.pngwing.com/pngs/521/255/png-transparent-computer-icons-data-file-document-file-format-others.png" style="margin: 0 0 0 -20px; max-height: 60px; max-width: 60px" align="left">
                                        <h5>{{ attach.preview }}</h5>
                                    </a>
                                {% endif %}
                                {% if attach.type == 'link' %}
                                    <a href="{{ attach.url|Cutthecrap:1 }}">
                                        <img src="{{ attach.preview }}" style="max-height: 100%; max-width: 100%; border-radius: 20px">
                                        <h4 style="display: block; margin-left: 10%; position: relative; width: 70%; color: #003366">{{ attach.url|Cutthecrap:0 }}</h4>
                                    </a>
                                {% endif %}
                            {% endfor %}

                            <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
                                        <div class="pswp__bg"></div>

                                        <div class="pswp__scroll-wrap">
                                            <div class="pswp__container">
                                                <div class="pswp__item"></div>
                                                <div class="pswp__item"></div>
                                                <div class="pswp__item"></div>
                                            </div>

                                            <div class="pswp__ui pswp__ui--hidden">
                                                <div class="pswp__top-bar">
                                                    <div class="pswp__counter"></div>
                                                        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                                                        <button class="pswp__button pswp__button--share" title="Share"></button>
                                                        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                                                        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                                                        <div class="pswp__preloader">
                                                            <div class="pswp__preloader__icn">
                                                                <div class="pswp__preloader__cut">
                                                                    <div class="pswp__preloader__donut"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                </div>
                                                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                                                    <div class="pswp__share-tooltip"></div>
                                                </div>
                                                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                                                </button>
                                                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                                                </button>
                                                <div class="pswp__caption">
                                                    <div class="pswp__caption__center"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                        </div>
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>
    <script src='http://code.jquery.com/jquery-1.7.1.js'></script>
    <script src="https://static.codepen.io/assets/common/stopExecutionOnTimeout-157cd5b220a5c80d4ff8e0e70ac069bffd87a61252088146915e8726e5d9f147.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js"></script>
    <script src="https://vk.com/js/api/openapi.js?168" type="text/javascript"></script>
    <script id="rendered-js">
        VK.init({
            apiId: 7609209
          });

        var initPhotoSwipeFromDOM = function(gallerySelector) {

            var parseThumbnailElements = function(el) {
                var thumbElements = el.childNodes,
                    numNodes = thumbElements.length,
                        items = [],
                        figureEl,
                        linkEl,
                        size,
                        item;

                for(var i = 0; i < numNodes; i++) {

                    figureEl = thumbElements[i];

                    if(figureEl.nodeType !== 1) {
                        continue;
                    }

                    linkEl = figureEl.children[0]; // <a> element

                    size = linkEl.getAttribute('data-size').split('x');

                    if(linkEl.getAttribute('type_content') == 'video') {

                        item = {
                            html: '<iframe style="width: 75%; height: 75%; position: absolute; top: 12%; left: 12%" src="'+linkEl.getAttribute('attach_another')+'" height="'+size[1]+'" width="'+size[0]+'"></iframe>'
                        };
                    }

                    else {
                        item = {
                            src: linkEl.getAttribute('href'),
                            w: parseInt(size[0], 10),
                            h: parseInt(size[1], 10)
                        };
                    }



                    if(figureEl.children.length > 1) {
                        item.title = figureEl.children[1].innerHTML;
                    }

                    if(linkEl.children.length > 0) {
                        item.msrc = linkEl.children[0].getAttribute('src');
                    }

                    item.el = figureEl;
                    items.push(item);
                }

                return items;
            };

            var closest = function closest(el, fn) {
                return el && ( fn(el) ? el : closest(el.parentNode, fn) );
            };

            var onThumbnailsClick = function(e) {
                e = e || window.event;
                e.preventDefault ? e.preventDefault() : e.returnValue = false;

                var eTarget = e.target || e.srcElement;

                var clickedListItem = closest(eTarget, function(el) {
                    return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
                });

                if(!clickedListItem) {
                    return;
                }

                var clickedGallery = clickedListItem.parentNode,
                    childNodes = clickedListItem.parentNode.childNodes,
                    numChildNodes = childNodes.length,
                    nodeIndex = 0,
                    index;

                for (var i = 0; i < numChildNodes; i++) {
                    if(childNodes[i].nodeType !== 1) {
                        continue;
                    }

                    if(childNodes[i] === clickedListItem) {
                        index = nodeIndex;
                        break;
                    }
                    nodeIndex++;
                }



                if(index >= 0) {
                    openPhotoSwipe( index, clickedGallery );
                }
                return false;
            };

            var photoswipeParseHash = function() {
                var hash = window.location.hash.substring(1),
                    params = {};

                if(hash.length < 5) {
                    return params;
                }

                var vars = hash.split('&');
                for (var i = 0; i < vars.length; i++) {
                    if(!vars[i]) {
                        continue;
                    }
                    var pair = vars[i].split('=');
                    if(pair.length < 2) {
                        continue;
                    }
                    params[pair[0]] = pair[1];
                }

                if(params.gid) {
                    params.gid = parseInt(params.gid, 10);
                }

                return params;
            };

            var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
                var pswpElement = document.querySelectorAll('.pswp')[0],
                    gallery,
                    options,
                    items;

                items = parseThumbnailElements(galleryElement);

                options = {

                    galleryUID: galleryElement.getAttribute('data-pswp-uid'),

                    getThumbBoundsFn: function(index) {
                        var thumbnail = items[index].el.getElementsByTagName('img')[0], // find thumbnail
                            pageYScroll = window.pageYOffset || document.documentElement.scrollTop,
                            rect = thumbnail.getBoundingClientRect();

                        return {x:rect.left, y:rect.top + pageYScroll, w:rect.width};
                    }

                };

                if(fromURL) {
                    if(options.galleryPIDs) {
                        for(var j = 0; j < items.length; j++) {
                            if(items[j].pid == index) {
                                options.index = j;
                                break;
                            }
                        }
                    } else {
                        options.index = parseInt(index, 10) - 1;
                    }
                } else {
                    options.index = parseInt(index, 10);
                }

                if( isNaN(options.index) ) {
                    return;
                }

                if(disableAnimation) {
                    options.showAnimationDuration = 0;
                }

                gallery = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items, options);
                gallery.init();
            };

            var galleryElements = document.querySelectorAll( gallerySelector );

            for(var i = 0, l = galleryElements.length; i < l; i++) {
                galleryElements[i].setAttribute('data-pswp-uid', i+1);
                galleryElements[i].onclick = onThumbnailsClick;
            }

            var hashData = photoswipeParseHash();
            if(hashData.pid && hashData.gid) {
                openPhotoSwipe( hashData.pid ,  galleryElements[ hashData.gid - 1 ], true, true );
            }
        };
        initPhotoSwipeFromDOM('.my-gallery');
    </script>
</body>
{% endblock content %}